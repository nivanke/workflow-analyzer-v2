<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workflow Analyzer</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="icon" href="icon.jpeg">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>Workflow Analyzer</h1>
        
        <div class="input-section">
            <textarea id="json-input" placeholder="Paste your JSON here..." rows="10">
                {
                    "workflow": {
                      "unique_name": "definition_workflow_02HP9XPYZJNOA3QNOXd1ckKyDDo0czB3zSs",
                      "name": "SentinelOne - Run Remote Script",
                      "title": "SentinelOne - Run Remote Script",
                      "type": "generic.workflow",
                      "base_type": "workflow",
                      "variables": [
                        {
                          "schema_id": "datatype.boolean",
                          "properties": {
                            "value": false,
                            "scope": "input",
                            "name": "Required Approval",
                            "type": "datatype.boolean",
                            "description": "Whether the task requires approval",
                            "is_required": false,
                            "display_on_wizard": false,
                            "is_invisible": false,
                            "variable_string_format": ""
                          },
                          "unique_name": "variable_workflow_02HPF3IYCWD4A40yVPZ45uAijmDTTHeKkGJ",
                          "object_type": "variable_workflow"
                        },
                        {
                          "schema_id": "datatype.string",
                          "properties": {
                            "value": "",
                            "scope": "input",
                            "name": "Script ID",
                            "type": "datatype.string",
                            "description": "The ID of the script to run",
                            "is_required": true,
                            "display_on_wizard": false,
                            "is_invisible": false,
                            "variable_string_format": "text"
                          },
                          "unique_name": "variable_workflow_02HP9ZNVE57SW2kNDVqoGWJGmBsGDP2rK9z",
                          "object_type": "variable_workflow"
                        },
                        {
                          "schema_id": "datatype.string",
                          "properties": {
                            "value": "",
                            "scope": "input",
                            "name": "Account IDs",
                            "type": "datatype.string",
                            "description": "One or more agent IDs to enable network connectivity for. If specifying a list of IDs, it should be JSON-formatted. For example: [\"id1\",\"id2\"]",
                            "is_required": false,
                            "display_on_wizard": false,
                            "is_invisible": false,
                            "variable_string_format": "text"
                          },
                          "unique_name": "variable_workflow_02HPEASOP6NZE27tEA91LGH3H2qSE8MQHGx",
                          "object_type": "variable_workflow"
                        },
                        {
                          "schema_id": "datatype.string",
                          "properties": {
                            "value": "None",
                            "scope": "input",
                            "name": "Output Destination",
                            "type": "datatype.string",
                            "description": "The destination for the script results. If not set, the output will be discarded. If set to None, the output will be written to the standard output",
                            "is_required": true,
                            "display_on_wizard": false,
                            "is_invisible": false,
                            "variable_string_format": "text"
                          },
                          "unique_name": "variable_workflow_02HPA0I9L8UXT5T9AUQ8nCXp1vFf0tzlLc5",
                          "object_type": "variable_workflow"
                        },
                        {
                          "schema_id": "datatype.string",
                          "properties": {
                            "value": "",
                            "scope": "input",
                            "name": "Task Description",
                            "type": "datatype.string",
                            "description": "The description of the task",
                            "is_required": true,
                            "display_on_wizard": false,
                            "is_invisible": false,
                            "variable_string_format": "text"
                          },
                          "unique_name": "variable_workflow_02HPA0QYCGK730yMkdWjQzzzKsloCkS8ZlH",
                          "object_type": "variable_workflow"
                        },
                        {
                          "schema_id": "datatype.string",
                          "properties": {
                            "value": "",
                            "scope": "input",
                            "name": "Agent IDs",
                            "type": "datatype.string",
                            "description": "One or more agent IDs to enable network connectivity for. If specifying a list of IDs, it should be JSON-formatted. For example: [\"id1\",\"id2\"]",
                            "is_required": true,
                            "display_on_wizard": false,
                            "is_invisible": false,
                            "variable_string_format": "text"
                          },
                          "unique_name": "variable_workflow_02HP9ZH1ZE6QQ7UMq3PM4CilsstXJoG9HY8",
                          "object_type": "variable_workflow"
                        },
                        {
                          "schema_id": "datatype.string",
                          "properties": {
                            "value": "",
                            "scope": "output",
                            "name": "Parent Task ID",
                            "type": "datatype.string",
                            "is_required": false,
                            "display_on_wizard": false,
                            "is_invisible": false,
                            "variable_string_format": "json"
                          },
                          "unique_name": "variable_workflow_02HPA164RQLPT1mwqcnmSQQ1PTigelzvjBc",
                          "object_type": "variable_workflow"
                        },
                        {
                          "schema_id": "datatype.integer",
                          "properties": {
                            "value": 3600,
                            "scope": "input",
                            "name": "Script Runtime Timeout",
                            "type": "datatype.integer",
                            "description": "Script runtime timout in seconds for current execution",
                            "is_required": false,
                            "display_on_wizard": false,
                            "is_invisible": false,
                            "variable_string_format": ""
                          },
                          "unique_name": "variable_workflow_02HPA09E3O6PO38IthYQUouMpQsjvodw0fv",
                          "object_type": "variable_workflow"
                        }
                      ],
                      "properties": {
                        "atomic": {
                          "atomic_group": "SentinelOne",
                          "is_atomic": true
                        },
                        "delete_workflow_instance": false,
                        "description": "This atomic allows to run a script on a machine managed by SentinelOne.\n\nTarget: SentinelOne integration target or an HTTP Endpoint for \"your-tenant.sentinelone.net\" with a path of \"/web/api/v2.1\"\n\nAccount Key: None if using an integration-provided target, API token if using an HTTP endpoint target\n\nSteps:\n[] Build the request payload\n[] Request to run remote script\n[] Check if request was successful:\n[]> If it was, attempt to extract parent task id\n[]> If it wasn't, output an error\n[] Set output variable\n\nMore information about this API can be found in the SentinelOne documentation",
                        "display_name": "SentinelOne - Run Remote Script",
                        "runtime_user": {
                          "target_default": true
                        },
                        "target": {
                          "target_type": "web-service.endpoint",
                          "target_id": "$module_target;SentinelOne;securex:ao:sentinelone;sentinelone-api$",
                          "execute_on_workflow_target": true
                        }
                      },
                      "object_type": "definition_workflow",
                      "actions": [
                        {
                          "unique_name": "definition_activity_02HPAFK64Z4CG21QFBtuS3ZADx8u1HBvCXW",
                          "name": "Execute Python Script",
                          "title": "Build the request payload",
                          "type": "python3.script",
                          "base_type": "activity",
                          "properties": {
                            "action_timeout": 180,
                            "continue_on_failure": false,
                            "display_name": "Build the request payload",
                            "script": "import sys\nimport json\n\n(\n  agentIds,\n  accountIds,\n  outputDestination,\n  scriptId,\n  scriptRuntimeTimeout,\n  taskDescription,\n  requiresApproval\n) = sys.argv[1:8]\n\ndef formatCommaSeparatedList(value):\n  return [x.strip() for x in value.split(',')]\n\npayload = {\n  \"data\": {\n    \"outputDestination\": outputDestination,\n    \"scriptId\": scriptId,\n    \"scriptRuntimeTimeoutSeconds\": scriptRuntimeTimeout,\n    \"taskDescription\": taskDescription,\n    \"requiresApproval\": requiresApproval\n  },\n  \"filter\": {\n    \"ids\": formatCommaSeparatedList(agentIds),\n    \"accountIds\": formatCommaSeparatedList(accountIds)\n  }\n}\n\npayload = json.dumps(payload)",
                            "script_arguments": [
                              "$workflow.definition_workflow_02HP9XPYZJNOA3QNOXd1ckKyDDo0czB3zSs.input.variable_workflow_02HP9ZH1ZE6QQ7UMq3PM4CilsstXJoG9HY8$",
                              "$workflow.definition_workflow_02HP9XPYZJNOA3QNOXd1ckKyDDo0czB3zSs.input.variable_workflow_02HPEASOP6NZE27tEA91LGH3H2qSE8MQHGx$",
                              "$workflow.definition_workflow_02HP9XPYZJNOA3QNOXd1ckKyDDo0czB3zSs.input.variable_workflow_02HPA0I9L8UXT5T9AUQ8nCXp1vFf0tzlLc5$",
                              "$workflow.definition_workflow_02HP9XPYZJNOA3QNOXd1ckKyDDo0czB3zSs.input.variable_workflow_02HP9ZNVE57SW2kNDVqoGWJGmBsGDP2rK9z$",
                              "$workflow.definition_workflow_02HP9XPYZJNOA3QNOXd1ckKyDDo0czB3zSs.input.variable_workflow_02HPA09E3O6PO38IthYQUouMpQsjvodw0fv$",
                              "$workflow.definition_workflow_02HP9XPYZJNOA3QNOXd1ckKyDDo0czB3zSs.input.variable_workflow_02HPA0QYCGK730yMkdWjQzzzKsloCkS8ZlH$",
                              "$workflow.definition_workflow_02HP9XPYZJNOA3QNOXd1ckKyDDo0czB3zSs.input.variable_workflow_02HPF3IYCWD4A40yVPZ45uAijmDTTHeKkGJ$"
                            ],
                            "script_queries": [
                              {
                                "script_query": "payload",
                                "script_query_name": "payload",
                                "script_query_type": "string"
                              }
                            ],
                            "skip_execution": false
                          },
                          "object_type": "definition_activity"
                        },
                        {
                          "unique_name": "definition_activity_02HPA1NUJNLGE4qlFedg8E4FiXaoyf0AGI0",
                          "name": "HTTP Request",
                          "title": "Request to run remote script",
                          "type": "web-service.http_request",
                          "base_type": "activity",
                          "properties": {
                            "accept": "application/json",
                            "action_timeout": 180,
                            "allow_auto_redirect": true,
                            "allow_headers_redirect": false,
                            "body": "$activity.definition_activity_02HPAFK64Z4CG21QFBtuS3ZADx8u1HBvCXW.output.script_queries.payload$",
                            "content_type": "application/json",
                            "continue_on_error_status_code": true,
                            "continue_on_failure": false,
                            "description": "/remote-scripts",
                            "display_name": "Request to run remote script",
                            "method": "POST",
                            "relative_url": "/remote-scripts/execute",
                            "runtime_user": {
                              "target_default": true
                            },
                            "skip_execution": false,
                            "target": {
                              "use_workflow_target": true
                            }
                          },
                          "object_type": "definition_activity"
                        },
                        {
                          "unique_name": "definition_activity_02HPA1PVCNV7M0uKzNiCyfhmamgs8MwyiCS",
                          "name": "Condition Block",
                          "title": "Was the request successful?",
                          "type": "logic.if_else",
                          "base_type": "activity",
                          "properties": {
                            "conditions": [],
                            "continue_on_failure": false,
                            "display_name": "Was the request successful?",
                            "skip_execution": false
                          },
                          "object_type": "definition_activity",
                          "blocks": [
                            {
                              "unique_name": "definition_activity_02HPA1PVJHJL31TP7zabaOz2AYWpNRb2hY0",
                              "name": "Condition Branch",
                              "title": "200/Success",
                              "type": "logic.condition_block",
                              "base_type": "activity",
                              "properties": {
                                "condition": {
                                  "left_operand": "$activity.definition_activity_02HPA1NUJNLGE4qlFedg8E4FiXaoyf0AGI0.output.status_code$",
                                  "operator": "eq",
                                  "right_operand": 200
                                },
                                "continue_on_failure": false,
                                "display_name": "200/Success",
                                "skip_execution": false
                              },
                              "object_type": "definition_activity",
                              "actions": [
                                {
                                  "unique_name": "definition_activity_02HPBYX8HP98F5hK85RrAmg7BxvvsW9Syuj",
                                  "name": "JSONPath Query",
                                  "title": "Extract parent task id",
                                  "type": "corejava.jsonpathquery",
                                  "base_type": "activity",
                                  "properties": {
                                    "action_timeout": 180,
                                    "continue_on_failure": true,
                                    "display_name": "Extract parent task id",
                                    "input_json": "$activity.definition_activity_02HPA1NUJNLGE4qlFedg8E4FiXaoyf0AGI0.output.response_body$",
                                    "jsonpath_queries": [
                                      {
                                        "jsonpath_query": "$.data.parentTaskId",
                                        "jsonpath_query_name": "parentTaskId",
                                        "jsonpath_query_type": "string",
                                        "zdate_type_format": "yyyy-MM-dd'T'HH:mm:ssZ"
                                      }
                                    ],
                                    "skip_execution": false
                                  },
                                  "object_type": "definition_activity"
                                },
                                {
                                  "unique_name": "definition_activity_02HPC0F8UUWS00rq69tJ7t32YhSOk92N3vX",
                                  "name": "Condition Block",
                                  "title": "Is extraction successful?",
                                  "type": "logic.if_else",
                                  "base_type": "activity",
                                  "properties": {
                                    "conditions": [],
                                    "continue_on_failure": false,
                                    "display_name": "Is extraction successful?",
                                    "skip_execution": false
                                  },
                                  "object_type": "definition_activity",
                                  "blocks": [
                                    {
                                      "unique_name": "definition_activity_02HPC0F8UVIC46rAdqG9Bx54N6gBokv11Dc",
                                      "name": "Condition Branch",
                                      "title": "No",
                                      "type": "logic.condition_block",
                                      "base_type": "activity",
                                      "properties": {
                                        "condition": {
                                          "left_operand": "$activity.definition_activity_02HPBYX8HP98F5hK85RrAmg7BxvvsW9Syuj.output.succeeded$",
                                          "operator": "eq",
                                          "right_operand": false
                                        },
                                        "continue_on_failure": false,
                                        "display_name": "No",
                                        "skip_execution": false
                                      },
                                      "object_type": "definition_activity",
                                      "actions": [
                                        {
                                          "unique_name": "definition_activity_02HPC0F8UX7E36gNPlKEqq41tYMr7ylarHE",
                                          "name": "Completed",
                                          "title": "Failed",
                                          "type": "logic.completed",
                                          "base_type": "activity",
                                          "properties": {
                                            "completion_type": "failed-completed",
                                            "continue_on_failure": false,
                                            "display_name": "Failed",
                                            "result_message": "Failed to fetch results.\n\nResponse body: $activity.definition_activity_02HPA1NUJNLGE4qlFedg8E4FiXaoyf0AGI0.output.response_body$",
                                            "skip_execution": false
                                          },
                                          "object_type": "definition_activity"
                                        }
                                      ]
                                    }
                                  ]
                                },
                                {
                                  "unique_name": "definition_activity_02HPA1UZPW2CB57nAgL2Lt3SmtPgXcLx2e5",
                                  "name": "Set Variables",
                                  "title": "Set output variable",
                                  "type": "core.set_multiple_variables",
                                  "base_type": "activity",
                                  "properties": {
                                    "continue_on_failure": false,
                                    "display_name": "Set output variable",
                                    "skip_execution": false,
                                    "variables_to_update": [
                                      {
                                        "variable_to_update": "$workflow.definition_workflow_02HP9XPYZJNOA3QNOXd1ckKyDDo0czB3zSs.output.variable_workflow_02HPA164RQLPT1mwqcnmSQQ1PTigelzvjBc$",
                                        "variable_value_new": "$activity.definition_activity_02HPBYX8HP98F5hK85RrAmg7BxvvsW9Syuj.output.jsonpath_queries.parentTaskId$"
                                      }
                                    ]
                                  },
                                  "object_type": "definition_activity"
                                }
                              ]
                            },
                            {
                              "unique_name": "definition_activity_02HPA1PVQLAWL3fYGatnRWjfCHP9hWWWvEe",
                              "name": "Condition Branch",
                              "title": "Anything else",
                              "type": "logic.condition_block",
                              "base_type": "activity",
                              "properties": {
                                "condition": {
                                  "left_operand": "$activity.definition_activity_02HPA1NUJNLGE4qlFedg8E4FiXaoyf0AGI0.output.status_code$",
                                  "operator": "ne",
                                  "right_operand": 200
                                },
                                "continue_on_failure": false,
                                "display_name": "Anything else",
                                "skip_execution": false
                              },
                              "object_type": "definition_activity",
                              "actions": [
                                {
                                  "unique_name": "definition_activity_02HPA1Y1FMVXI0SPna8WyY0efzY7BXyEBvQ",
                                  "name": "Completed",
                                  "title": "Failed",
                                  "type": "logic.completed",
                                  "base_type": "activity",
                                  "properties": {
                                    "completion_type": "failed-completed",
                                    "continue_on_failure": false,
                                    "display_name": "Failed",
                                    "result_message": "Failed to run remote script in SentinelOne.\n\nStatus code:  $activity.definition_activity_02HPA1NUJNLGE4qlFedg8E4FiXaoyf0AGI0.output.status_code$\nResponse body: $activity.definition_activity_02HPA1NUJNLGE4qlFedg8E4FiXaoyf0AGI0.output.response_body$",
                                    "skip_execution": false
                                  },
                                  "object_type": "definition_activity"
                                }
                              ]
                            }
                          ]
                        }
                      ],
                      "categories": ["category_1BMfMXSnJMyt5Ihqi7rWJr5N8cf"],
                      "metadata": {
                        "flags": ["third-party", "xdr"]
                      }
                    },
                    "module_targets": [
                      {
                        "module_type": "SentinelOne",
                        "external_id": "securex:ao:sentinelone",
                        "proxy_endpoint_metadata_id": "sentinelone-api"
                      }
                    ]
                  }
                  
            </textarea>
            <button id="analyze-button">Analyze</button>
        </div>

        <div id="results"></div>
    </div>

    <script type="module" src="handlers/button-handler.js"></script>
</body>
</html>